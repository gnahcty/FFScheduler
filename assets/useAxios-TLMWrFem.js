import{p as $,a5 as C,n as F,k as f}from"./index-h6YQ8WaB.js";import{a as w,m as T,f as y}from"./format-COcY_L_q.js";function N(r,e){const t=(e==null?void 0:e.additionalDigits)??2,n=x(r);let i;if(n.date){const o=Y(n.date,t);i=B(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const c=i.getTime();let u=0,g;if(n.time&&(u=M(n.time),isNaN(u)))return new Date(NaN);if(n.timezone){if(g=R(n.timezone),isNaN(g))return new Date(NaN)}else{const o=new Date(c+u),a=new Date(0);return a.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),a.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),a}return new Date(c+u+g)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},I=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,U=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,S=/^([+-])(\d{2})(?::?(\d{2}))?$/;function x(r){const e={},t=r.split(D.dateTimeDelimiter);let n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],D.timeZoneDelimiter.test(e.date)&&(e.date=r.split(D.timeZoneDelimiter)[0],n=r.substr(e.date.length,r.length))),n){const i=D.timezone.exec(n);i?(e.time=n.replace(i[1],""),e.timezone=i[1]):e.time=n}return e}function Y(r,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=r.match(t);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,c=n[2]?parseInt(n[2]):null;return{year:c===null?i:c*100,restDateString:r.slice((n[1]||n[2]).length)}}function B(r,e){if(e===null)return new Date(NaN);const t=r.match(I);if(!t)return new Date(NaN);const n=!!t[4],i=d(t[1]),c=d(t[2])-1,u=d(t[3]),g=d(t[4]),o=d(t[5])-1;if(n)return Z(e,g,o)?z(e,g,o):new Date(NaN);{const a=new Date(0);return!k(e,c,u)||!O(e,i)?new Date(NaN):(a.setUTCFullYear(e,c,Math.max(i,u)),a)}}function d(r){return r?parseInt(r):1}function M(r){const e=r.match(U);if(!e)return NaN;const t=p(e[1]),n=p(e[2]),i=p(e[3]);return v(t,n,i)?t*w+n*T+i*1e3:NaN}function p(r){return r&&parseFloat(r.replace(",","."))||0}function R(r){if(r==="Z")return 0;const e=r.match(S);if(!e)return 0;const t=e[1]==="+"?-1:1,n=parseInt(e[2]),i=e[3]&&parseInt(e[3])||0;return H(n,i)?t*(n*w+i*T):NaN}function z(r,e,t){const n=new Date(0);n.setUTCFullYear(r,0,4);const i=n.getUTCDay()||7,c=(e-1)*7+t+1-i;return n.setUTCDate(n.getUTCDate()+c),n}const E=[31,null,31,30,31,30,31,31,30,31,30,31];function h(r){return r%400===0||r%4===0&&r%100!==0}function k(r,e,t){return e>=0&&e<=11&&t>=1&&t<=(E[e]||(h(r)?29:28))}function O(r,e){return e>=1&&e<=(h(r)?366:365)}function Z(r,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function v(r,e,t){return r===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&r>=0&&r<25}function H(r,e){return e>=0&&e<=59}function _(){const r=$(),{currentCategory:e}=C(F()),t=(a,s,m="",l=1e3)=>{r.add({severity:a,summary:s,detail:m,life:l})};return{getCategoryList:async()=>{try{const{data:a}=await f.get("film/categories");return a.result}catch(a){console.log(`error in getting categories: ${a}`),t("error","錯誤","無法取得影展單元資料")}},getFilmsByCategory:async a=>{try{const{data:s}=await f.get(`film/films/${a}`);if(!s||!s.result)throw new Error("no data");return e.value=s.result.map(m=>m._id),s.result}catch(s){console.log(`error in getting films: ${s}`),t("error","錯誤",`無法取得${a}資料`)}},getFilmById:async a=>{try{const{data:s}=await f.get(`film/${a}`);return s.result}catch(s){console.log(`error in getting films: ${s}`),t("error","錯誤","無法取得電影資料")}},getScreeningsByFilmId:async a=>{try{const{data:s}=await f.get(`screening/${a}`);if(!s||!s.result)throw new Error("此id查無場次");return s.result.map(l=>({...l,date:y(N(l.time),"MM.dd EEE."),time:y(N(l.time),"HH:mm"),place:l.QASessions?`${l.place} ▲`:l.place}))}catch(s){console.log(`error in getting screenings: ${s}`),t("error","錯誤","無法取得場次資料")}},getScreeningsByDate:async a=>{try{const{data:s}=await f.get(`screening/date/${a}`);return!s||!s.result?(t("info","此日期無場次"),[]):s.result}catch(s){console.log(`error in getting screenings for ${a}: ${s}`),t("error","錯誤","無法取得場次資料")}},getFFDateRange:async()=>{try{const{data:a}=await f.get("screening/FFDate");if(!a||!a.result)throw new Error("no data");return a.result}catch(a){console.log(`error in getting festival date range: ${a}`),t("error","錯誤","無法取得影展日期資料")}}}}export{N as p,_ as u};
